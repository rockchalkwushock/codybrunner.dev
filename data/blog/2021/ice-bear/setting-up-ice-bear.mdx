---
archived: false
createdAt: 06/11/2021
description: 'Part 2: Getting Ice Bear all set up for his big adventure! In this post I setup Fly.io, GitHub, Phoenix, and Telegram.'
keywords:
  - fly.io
  - elixir
  - github
  - phoenix
  - phoenix liveview
  - telegram
  - telegram bot
published: false
tags:
  - elixir
  - live-view
  - phoenix
title: 'Ice Bear: Setup'
---

import { Signature } from '../components/MDXComponents.tsx'

## Bringing Life to Ice Bear

```shell
mix phx.new ice_bear --live
...
Fetch and install dependencies? [Yn] n

We are almost there! The following steps are missing:

    $ cd ice_bear
    $ mix deps.get
    $ cd assets && npm install && node node_modules/webpack/bin/webpack.js --mode development

Then configure your database in config/dev.exs and run:

    $ mix ecto.create

Start your Phoenix app with:

    $ mix phx.server

You can also run your app inside IEx (Interactive Elixir) as:

    $ iex -S mix phx.server
```

One of the first things we should do is update the `.gitignore` to ignore any file that has `secret` in it as this is where Phoenix is expecting us to put environment variables that are super secret and could get us double probation if they end up on GitHub!

```ignore:.gitignore
# Secrets
/config/*.secret.exs
```

Here is a link to the [initial commit](https://github.com/rockchalkwushock/ice-bear/commit/aba12121c37b54ff638e1add700453ebfad0610b) if you need to refer to anything. From here on out any link to the official repository of Ice Bear will be links to the merged PR's.

### Updating the Client-Side JavaScript Build

I am not going to touch to heavily on this because you can read a more in depth article on how to this [here](https://codybrunner.dev/blog/2021/esbuild-pnpm-and-tailwind-in-phoenix). What I am doing here is to move JavaScript dependency management to `pnpm`, JavaScript bundling to be handled by `webpack@5` and `esbuild-loader`, and add support for `tailwindcss` in `jit` mode.

## Configuring Ice Bear's database

We need to make a few quick changes before we tell `mix` to create Ice Bear's databases. First create a secrets file for our dev environment so we are not exposing things we shouldn't in our git history. We are also going to update all of our config files to use `import Config` instead of `use Mix.Config` since the latter is scheduled for deprecation in the future:

```shell
touch config/dev.secrets.exs
```

```elixir:config/dev.secrets.exs
import Config

config :ice_bear, IceBear.Repo,
  username: "YOUR USERNAME",
  password: "YOUR PASSWORD"
```

And now in the `dev.exs` we need to import the config and remove a few lines of code:

```diff:config/dev.exs
- use Mix.Config
+ import Config

# Configure your database
config :ice_bear, IceBear.Repo,
- username: "postgres",
- password: "postgres",
  database: "ice_bear_dev",
  hostname: "localhost",
  show_sensitive_data_on_connection_error: true,
  pool_size: 10

# For development, we disable any cache and enable
# debugging and code reloading.
#
# The watchers configuration can be used to run external
# watchers to your application. For example, we use it
# with webpack to recompile .js and .css sources.
config :ice_bear, IceBearWeb.Endpoint,
  http: [port: 4000],
  debug_errors: true,
  code_reloader: true,
  check_origin: false,
  watchers: [
    pnpm: [
      "run",
      "watch",
      cd: Path.expand("../assets", __DIR__)
    ]
  ]

# ## SSL Support
#
# In order to use HTTPS in development, a self-signed
# certificate can be generated by running the following
# Mix task:
#
#     mix phx.gen.cert
#
# Note that this task requires Erlang/OTP 20 or later.
# Run `mix help phx.gen.cert` for more information.
#
# The `http:` config above can be replaced with:
#
#     https: [
#       port: 4001,
#       cipher_suite: :strong,
#       keyfile: "priv/cert/selfsigned_key.pem",
#       certfile: "priv/cert/selfsigned.pem"
#     ],
#
# If desired, both `http:` and `https:` keys can be
# configured to run both http and https servers on
# different ports.

# Watch static and templates for browser reloading.
config :ice_bear, IceBearWeb.Endpoint,
  live_reload: [
    patterns: [
      ~r"priv/static/.*(js|css|png|jpeg|jpg|gif|svg)$",
      ~r"priv/gettext/.*(po)$",
      ~r"lib/ice_bear_web/(live|views)/.*(ex)$",
      ~r"lib/ice_bear_web/templates/.*(eex)$"
    ]
  ]

# Do not include metadata nor timestamps in development logs
config :logger, :console, format: "[$level] $message\n"

# Set a higher stacktrace during development. Avoid configuring such
# in production as building large stacktraces may be expensive.
config :phoenix, :stacktrace_depth, 20

# Initialize plugs at runtime for faster development compilation
config :phoenix, :plug_init_mode, :runtime

+ import_config "dev.secret.exs"
```

```shell
mix ecto.setup

Compiling 13 files (.ex)
Generated ice_bear app
The database for IceBear.Repo has been created

10:15:40.163 [info]  Migrations already up
```

You can find all the diffs for the files touched in this section in [Pull Request #1](https://github.com/rockchalkwushock/ice-bear/pull/1).

## The BotFather

Telegram has a bot that is specifically designed for the purpose of creating your own bots called the [@BotFather](https://t.me/BotFather). You will see something like below to get started with him:

![Starting up the BotFather](/images/2021/ice-bear/bot-father.png)

To create a new bot we will send the command `/newbot` to BotFather and he will prompt us for a bot name and bot username. The only thing to note is that the username must be include `bot` in some way shape or form. Unfortunately as you can see many of the names I wanted were already taken but I was able to create Ice Bear under the username [@icebarebot](https://t.me/icebarebot):

> **Note:** Please be advised the token you see is no longer active or associated with Ice Bear.

![Creating a new bot with Bot Father](/images/2021/ice-bear/newbot.png)

The first thing we will want to do after creating the bot is to take the API Token and put it somewhere safe and somewhere where it will not end up being committed to GitHub. For now we will add the token to `dev.secret.exs` file for injecting the API Token into our development environment at build time.

```diff:config/dev.secret.exs
import Config

config :ice_bear, IceBear.Repo,
  username: "local_dev",
  password: "postgres"

+ config :ice_bear,
+   bot_token: "YOUR API TOKEN HERE"

```

After creating your new bot you should have a very similar profile (besides name and username of course). You can go through BotFather's list of commands to customize the profile like you see for Ice Bear below:

![A new bot profile](/images/2021/ice-bear/newbot-profile.png)

![Customized bot profile](/images/2021/ice-bear/customized-bot-profile.png)

## Deploying Ice Bear with Fly.io

## CI/CD with GitHub Actions

<Signature>~ Cody ðŸš€</Signature>
